const express = require('express');
const router = express.Router();
const helper = require('../utils/helper');
const DOMParser = require('xmldom').DOMParser;

router.post('/details', function(req, res) {
    const xmlData = req.body.data //'<player><details><player_type>BATTER</player_type><hand>R</hand><first>HANK</first><last>AARON</last><year>2019</year><team>HOF</team><lefty>29% VS.LEFTY PITCHERS</lefty><power_left>Power-N</power_left><fielding>rf-1(-2)e6/ 1b-4e7/ cf-2e6 </fielding><righty>71% VS.RIGHTY PITCHERS</righty><power_right>Power-N</power_right><stealing>stealing-(C) *6/- (17-6)</stealing><bunting>bunting-C</bunting><hitnrun>hit &amp; run-B</hitnrun><running>running 1-16</running></details><cols><col><lines><line ><display><span line="1">◆2-<b>HR</b> 1-8</span><span line="2"> fly (lf) B 9-20</span></display><crapline>◆2-HR 1-8 fly (lf) B 9-20</crapline></line><line ><display><span line="1">▼3-<b>SINGLE (lf)</b></span></display><crapline>▼3-SINGLE (lf)</crapline></line><line roll="4"><display><span line="1">4-gb (2b) <u>C</u></span></display><crapline>gb (2b) C</crapline></line><line roll="5"><display><span line="1">5-<b>TR</b> 1-4</span><span line="2"> <b>DO </b> 5-20</span></display><triple roll="1-4">1</triple><crapline>DO  5-20</crapline></line><line roll="6"><display><span line="1">6-<b>HOMERUN</b></span></display><homerun injury="1">1</homerun></line><line roll="7"><display><span line="1">7-<b>WALK</b></span></display><walk injury="1">1</walk></line><line roll="8"><display><span line="1">8-popout (ss)</span></display><crapline>popout (ss)</crapline></line><line ><display><span line="1">◆9-<b>HOMERUN</b></span></display><crapline>◆9-HOMERUN</crapline></line><line roll="10"><display><span line="1">10-<b>HOMERUN</b></span></display><homerun injury="1">1</homerun></line><line ><display><span line="1">◆11-fly (lf) B&amp;#003F;</span></display><crapline>◆11-fly (lf) B?</crapline></line><line roll="12"><display><span line="1">12-fly (cf) A</span></display><crapline>fly (cf) A</crapline></line></lines></col><col><lines><line roll="2"><display><span line="1">2-<b>HBP</b></span><span line="2"> plus injury</span></display><crapline>HBP plus injury</crapline></line><line ><display><span line="1">Δ3-gb (3b) B</span><span line="2"><i> <b>SI*</b> 1-5</i></span><span line="3"><i> lo 6-20</i></span></display><crapline>Δ3-gb (3b) B SI 1-5 lineout 6-20</crapline></line><line roll="4"><display><span line="1">4-gb (3b) A</span></display><crapline>gb (3b) A</crapline></line><line roll="5"><display><span line="1">5-gb (ss) A</span></display><crapline>gb (ss) A</crapline></line><line roll="6"><display><span line="1">6-<b>SINGLE (cf)</b></span></display><crapline>SINGLE (cf)</crapline></line><line roll="7"><display><span line="1">7-<b>DO**</b> 1-4</span><span line="2"> <b>SI**</b> 5-20</span></display><double roll="1-4">1</double><single roll="5-20">1</single></line><line roll="8"><display><span line="1">8-gb (p) B</span></display><crapline>gb (p) B</crapline></line><line roll="9"><display><span line="1">9-fly (cf) B&amp;#003F;</span></display><crapline>fly (cf) B?</crapline></line><line ><display><span line="1">▼10-fly (rf) B&amp;#003F;</span></display><crapline>▼10-fly (rf) B?</crapline></line><line roll="11"><display><span line="1">11-gb (1b) <u>C</u></span></display><crapline>gb (1b) C</crapline></line><line roll="12"><display><span line="1">12-lo (3b) max</span></display><crapline>lo (3b) max</crapline></line></lines></col><col><lines><line roll="2"><display><span line="1">2-gb (2b) <u>C</u></span></display><crapline>gb (2b) C</crapline></line><line roll="3"><display><span line="1">3-gb (ss) A</span></display><crapline>gb (ss) A</crapline></line><line roll="4"><display><span line="1">4-strikeout</span></display><strikeout injury="1">1</strikeout></line><line roll="5"><display><span line="1">5-<b>SI*</b> 1-10</span><span line="2"> lo (3b) 11-20</span></display><single roll="1-10">1</single><crapline>lo (3b) 11-20</crapline></line><line roll="6"><display><span line="1">6-<b>SINGLE**</b></span></display><single injury="1">1</single></line><line roll="7"><display><span line="1">7-gb (ss) A+</span></display><crapline>gb (ss) A+</crapline></line><line roll="8"><display><span line="1">8-<b>WALK</b></span></display><walk injury="1">1</walk></line><line roll="9"><display><span line="1">9-strikeout</span></display><strikeout injury="1">1</strikeout></line><line roll="10"><display><span line="1">10-fly (lf) B&amp;#003F;</span></display><crapline>fly (lf) B?</crapline></line><line roll="11"><display><span line="1">11-<b>HR</b> 1-15</span><span line="2"> fly (lf) B 16-20</span></display><homerun roll="1-15">1</homerun><crapline>fly (lf) B 16-20</crapline></line><line ><display><span line="1">◆12-fly (lf) B&amp;#003F;</span></display><crapline>◆12-fly (lf) B?</crapline></line></lines></col><col><lines><line ><display><span line="1">◆2-<b>HR</b> 1-8</span><span line="2"> fly (lf) B 9-20</span></display><crapline>◆2-HR 1-8 fly (lf) B 9-20</crapline></line><line ><display><span line="1">▼3-<b>SINGLE (rf)</b></span></display><crapline>▼3-SINGLE (rf)</crapline></line><line roll="4"><display><span line="1">4-gb (3b) B</span></display><crapline>gb (3b) B</crapline></line><line roll="5"><display><span line="1">5-<b>DO**</b> 1</span><span line="2"> <b>SI**</b> 2-20</span></display><crapline>DO 1 SI 2-20</crapline></line><line roll="6"><display><span line="1">6-<b>HOMERUN</b></span></display><homerun injury="1">1</homerun></line><line roll="7"><display><span line="1">7-<b>TR</b> 1</span><span line="2"> <b>DO </b> 2-20</span></display><crapline>TR 1 DO  2-20</crapline></line><line roll="8"><display><span line="1">8-popout (ss)</span></display><crapline>popout (ss)</crapline></line><line ><display><span line="1">◆9-<b>HOMERUN</b></span></display><crapline>◆9-HOMERUN</crapline></line><line roll="10"><display><span line="1">10-<b>HR</b> 1-19</span><span line="2"> <b>TR</b> 20</span></display><homerun roll="1-19">1</homerun><crapline>TR 20</crapline></line><line ><display><span line="1">◆11-fly (lf) B&amp;#003F;</span></display><crapline>◆11-fly (lf) B?</crapline></line><line roll="12"><display><span line="1">12-fly (cf) A</span></display><crapline>fly (cf) A</crapline></line></lines></col><col><lines><line roll="2"><display><span line="1">2-<b>HBP</b></span><span line="2"> plus injury</span></display><crapline>HBP plus injury</crapline></line><line roll="3"><display><span line="1">3-gb (p) B</span></display><crapline>gb (p) B</crapline></line><line ><display><span line="1">▼4-gb (p) B</span></display><crapline>▼4-gb (p) B</crapline></line><line roll="5"><display><span line="1">5-gb (3b) A</span></display><crapline>gb (3b) A</crapline></line><line roll="6"><display><span line="1">6-<b>SINGLE (lf)</b></span></display><crapline>SINGLE (lf)</crapline></line><line roll="7"><display><span line="1">7-<b>SINGLE**</b></span></display><single injury="1">1</single></line><line roll="8"><display><span line="1">8-gb (ss) A</span></display><crapline>gb (ss) A</crapline></line><line roll="9"><display><span line="1">9-gb (ss) A+</span></display><crapline>gb (ss) A+</crapline></line><line roll="10"><display><span line="1">10-gb (2b) <u>C</u></span></display><crapline>gb (2b) C</crapline></line><line roll="11"><display><span line="1">11-gb (1b) <u>C</u></span></display><crapline>gb (1b) C</crapline></line><line roll="12"><display><span line="1">12-lo (3b) max</span></display><crapline>lo (3b) max</crapline></line></lines></col><col><lines><line roll="2"><display><span line="1">2-gb (2b) <u>C</u></span></display><crapline>gb (2b) C</crapline></line><line roll="3"><display><span line="1">3-gb (ss) A+</span></display><crapline>gb (ss) A+</crapline></line><line roll="4"><display><span line="1">4-fly (rf) B&amp;#003F;</span></display><crapline>fly (rf) B?</crapline></line><line roll="5"><display><span line="1">5-<b>SI*</b> 1-8</span><span line="2"> lo (3b) 9-20</span></display><single roll="1-8">1</single><crapline>lo (3b) 9-20</crapline></line><line roll="6"><display><span line="1">6-<b>WALK</b></span></display><walk injury="1">1</walk></line><line roll="7"><display><span line="1">7-fly (cf) B&amp;#003F;</span></display><crapline>fly (cf) B?</crapline></line><line roll="8"><display><span line="1">8-<b>WALK</b></span></display><walk injury="1">1</walk></line><line roll="9"><display><span line="1">9-strikeout</span></display><strikeout injury="1">1</strikeout></line><line roll="10"><display><span line="1">10-strikeout</span></display><strikeout injury="1">1</strikeout></line><line ><display><span line="1">Δ11-fly (lf) B&amp;#003F;</span><span line="2"><i> <b>SI*</b> 1-5</i></span><span line="3"><i> lo 6-20</i></span></display><crapline>Δ11-fly (lf) B? SI 1-5 lineout 6-20</crapline></line><line ><display><span line="1">◆12-fly (lf) B&amp;#003F;</span></display><crapline>◆12-fly (lf) B?</crapline></line></lines></col></cols></player>';
    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(xmlData, "text/xml");
    const xmlSrc = xmlDoc.documentElement.childNodes;
    const data = helper.getPlayerDetails(xmlSrc);
    let playerInitailDetail = data.playerInitailDetail;
    const parseData = {...data};
    playerInitailDetail['stealing1String'] = playerInitailDetail['stealing'] ? helper.getStealingString1(parseData) : '';
    playerInitailDetail['stealing2String'] = playerInitailDetail['stealing'] ? helper.getStealingString2(parseData) : '';
    playerInitailDetail['buntingString'] = playerInitailDetail['bunting'] ? helper.getBuntingString(parseData) : '';
    playerInitailDetail['hintrunString'] = playerInitailDetail['hitnrun'] ? helper.getHitNRunString(parseData) : '';
    playerInitailDetail['runningString'] = playerInitailDetail['running'] ? helper.getRunningString(parseData) : '';
    playerInitailDetail['numberRightString3'] = playerInitailDetail['numbers_right'] ? helper.getNumberRightString3(parseData): '';
    playerInitailDetail['pitcherBuntingString2'] = playerInitailDetail['bunting'] ? helper.getPitcherBuntingString2(parseData) : '';
    playerInitailDetail['feildingString'] = playerInitailDetail['fielding'] ? helper.getFeildingString(parseData) : '';
    playerInitailDetail['numberRightString2'] = playerInitailDetail['numbers_right'] ? helper.getNumberRightString2(parseData) : '';
    playerInitailDetail['bumberRightString1'] = playerInitailDetail['numbers_right'] ? helper.getNumberRightString1(parseData) : '';
    playerInitailDetail['pitcherBuntingString1'] = playerInitailDetail['bunting'] ? helper.getPitcherBuntingString1(parseData) : '';
    res.send(playerInitailDetail);
});

module.exports = router;